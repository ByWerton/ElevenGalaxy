<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ElevenGalaxy™</title>
  <style>
    body { margin:0; font-family:sans-serif; background:#f0f0f0; color:#333; }
    .center { max-width:400px; margin:100px auto; padding:20px; text-align:center; background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    input, button { width:100%; margin:8px 0; padding:10px; border:1px solid #ccc; border-radius:4px; font-size:16px; }
    button { cursor:pointer; background:#4CAF50; color:white; }
    #menuBtn { position:fixed; top:10px; left:10px; font-size:24px; cursor:pointer; z-index:1001; display:none; }
    #menuNav { position:fixed; top:0; left:0; height:100%; width:0; background:#222; overflow-x:hidden; transition:0.3s; z-index:1000; padding-top:60px; color:white; }
    #menuNav.visible { width:250px; }
    #menuNav a { padding:8px 32px; text-decoration:none; color:white; display:block; transition:0.3s; }
    #menuNav a:hover { background:#575757; }
    .msgErr { color:red; margin-top:10px; }
    .msgSuc { color:green; margin-top:10px; }
    #loading { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:2000; justify-content:center; align-items:center; }
    .spinner { border:8px solid #f3f3f3; border-top:8px solid #3498db; border-radius:50%; width:60px; height:60px; animation:spin 1s linear infinite; }
    @keyframes spin { 100% { transform:rotate(360deg); } }
    .dark-mode { background:#222; color:#eee; }
    .dark-mode input, .dark-mode button { background:#333; color:white; border-color:#555; }
  </style>
</head>
<body>

<div id="menuBtn">☰</div>

<div id="menuNav">
  <a href="#" id="menuClose">Menüyü Kapat ✖</a>
  <a href="#">Mesajlaşma 📩</a>
  <a href="#">Leader Board 🏆</a>
  <a href="#">Kaydolanlar 👥</a>
  <a href="#" id="toggleDark">🌙 / ☀️ Karanlık Mod</a>
  <a href="#" id="logoutBtn">Çıkış Yap 🚪</a>
</div>

<div id="loading"><div class="spinner"></div></div>

<div class="center" id="authSec">
  <h2>ElevenGalaxy™</h2>
  <input type="text" id="regUsername" placeholder="Kullanıcı Adı (Kayıt için)">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Şifre">
  <button id="loginBtn">Giriş Yap</button>
  <button id="regBtn">Kayıt Ol</button>
  <div class="msgErr" id="msgErr"></div>
  <div class="msgSuc" id="msgSuc"></div>
</div>

<div class="center" id="welcome" style="display:none;">
  <h2>Hoşgeldin, <span id="welcomeName"></span>!</h2>
</div>

<!-- Firebase + App JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-database.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC05FCX8S8uU0a1airGrjPPKiMpO4bwT7U",
    authDomain: "elevengalaxy-web.firebaseapp.com",
    projectId: "elevengalaxy-web",
    storageBucket: "elevengalaxy-web.firebasestorage.app",
    messagingSenderId: "1044606246550",
    appId: "1:1044606246550:web:ba8d2759baa146f59f2cb7",
    measurementId: "G-V4M47VJ409"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // Elements
  const menuBtn = document.getElementById("menuBtn");
  const menuNav = document.getElementById("menuNav");
  const menuClose = document.getElementById("menuClose");
  const toggleDark = document.getElementById("toggleDark");
  const logoutBtn = document.getElementById("logoutBtn");
  const authSec = document.getElementById("authSec");
  const welcome = document.getElementById("welcome");
  const welcomeName = document.getElementById("welcomeName");
  const regUsername = document.getElementById("regUsername");
  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const loginBtn = document.getElementById("loginBtn");
  const regBtn = document.getElementById("regBtn");
  const msgErr = document.getElementById("msgErr");
  const msgSuc = document.getElementById("msgSuc");
  const loading = document.getElementById("loading");

  function showLoad(show) { loading.style.display = show ? "flex" : "none"; }
  function clearMsgs() { msgErr.innerText=""; msgSuc.innerText=""; }

  // Auth state
  onAuthStateChanged(auth, user=>{
    if(user){
      authSec.style.display="none";
      welcome.style.display="block";
      menuBtn.style.display="block";
      showLoad(1);
      get(child(ref(db), "users/"+user.uid+"/username"))
        .then(snapshot=>{
          welcomeName.innerText=snapshot.exists() ? snapshot.val() : user.email;
          showLoad(0);
        })
        .catch(e=>{ console.error(e); showLoad(0); });
    } else {
      authSec.style.display="block";
      welcome.style.display="none";
      menuBtn.style.display="none";
      menuNav.classList.remove("visible");
      showLoad(0);
    }
  });

  // Kayıt ol
  regBtn.onclick=()=>{
    clearMsgs(); showLoad(1);
    createUserWithEmailAndPassword(auth, email.value, password.value)
      .then(cred=>{
        return set(ref(db, "users/"+cred.user.uid), {
          username: regUsername.value,
          email: email.value
        });
      })
      .then(()=>{
        msgSuc.innerText="Kayıt başarılı. Giriş yapabilirsiniz.";
      })
      .catch(e=>{
        msgErr.innerText=e.message;
      })
      .finally(()=>showLoad(0));
  };

  // Giriş yap
  loginBtn.onclick=()=>{
    clearMsgs(); showLoad(1);
    signInWithEmailAndPassword(auth, email.value, password.value)
      .catch(e=>{
        msgErr.innerText=e.message;
      })
      .finally(()=>showLoad(0));
  };

  // Çıkış yap
  logoutBtn.onclick=()=>{
    showLoad(1);
    signOut(auth).finally(()=>showLoad(0));
  };

  // Menü aç/kapat
  menuBtn.onclick=_=>{
    menuNav.classList.toggle("visible");
  };
  menuClose.onclick=_=>{
    menuNav.classList.remove("visible");
  };

  // Karanlık mod
  toggleDark.onclick=_=>{
    document.body.classList.toggle("dark-mode");
  };
</script>

</body>
</html>
